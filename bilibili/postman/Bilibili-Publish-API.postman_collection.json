{
  "info": {
    "name": "Bilibili Publish API",
    "description": "Bç«™è§†é¢‘ä¸€é”®å‘å¸ƒ API æµ‹è¯•é›†åˆ\n\næµ‹è¯•é¡ºåºï¼š\n1. è·å–ç™»å½•äºŒç»´ç \n2. è½®è¯¢ç™»å½•çŠ¶æ€ï¼ˆæ‰«ç åï¼‰\n3. æ£€æŸ¥ç™»å½•çŠ¶æ€ï¼ˆåˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°æ‰«ç ï¼‰\n4. è·å–ç”¨æˆ·ä¿¡æ¯\n5. ä¸Šä¼ è§†é¢‘æ–‡ä»¶\n6. å‘å¸ƒè§†é¢‘\n7. æŸ¥è¯¢ä¸Šä¼ çŠ¶æ€",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "qrcodeKey",
      "value": "",
      "type": "string"
    },
    {
      "key": "taskId",
      "value": "",
      "type": "string"
    },
    {
      "key": "uploadedFilePath",
      "value": "",
      "type": "string"
    },
    {
      "key": "userId",
      "value": "3494365068528056",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. ç™»å½•æµç¨‹",
      "description": "Bç«™æ‰«ç ç™»å½•æµç¨‹",
      "item": [
        {
          "name": "1.1 è·å–ç™»å½•äºŒç»´ç ",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('çŠ¶æ€ç ä¸º200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('è¿”å›äºŒç»´ç æ•°æ®', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json.code).to.eql(200);",
                  "    pm.expect(json.data).to.have.property('qrcodeUrl');",
                  "    pm.expect(json.data).to.have.property('qrcodeKey');",
                  "    ",
                  "    // è‡ªåŠ¨ä¿å­˜ qrcodeKey åˆ°å˜é‡",
                  "    pm.collectionVariables.set('qrcodeKey', json.data.qrcodeKey);",
                  "    ",
                  "    console.log('äºŒç»´ç URL: ' + json.data.qrcodeUrl);",
                  "    console.log('qrcodeKey: ' + json.data.qrcodeKey);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/bilibili/qrcode",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bilibili", "qrcode"]
            },
            "description": "è·å–Bç«™ç™»å½•äºŒç»´ç ã€‚\n\nè¿”å›çš„ qrcodeUrl å¯ç”¨æµè§ˆå™¨æ‰“å¼€æˆ–ç”ŸæˆäºŒç»´ç å›¾ç‰‡ï¼Œç”¨Bç«™APPæ‰«ç ç™»å½•ã€‚\n\nqrcodeKey ä¼šè‡ªåŠ¨ä¿å­˜åˆ°é›†åˆå˜é‡ï¼Œä¾›åç»­è½®è¯¢ä½¿ç”¨ã€‚"
          },
          "response": [
            {
              "name": "æˆåŠŸç¤ºä¾‹",
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"code\": 200,\n  \"message\": \"success\",\n  \"data\": {\n    \"qrcodeUrl\": \"https://passport.bilibili.com/x/passport-tv-login/h5/qrcode/auth?auth_code=9f5dee5137d48273d07ec2259fe46601\",\n    \"qrcodeKey\": \"9f5dee5137d48273d07ec2259fe46601\"\n  }\n}"
            }
          ]
        },
        {
          "name": "1.2 è½®è¯¢ç™»å½•çŠ¶æ€",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('çŠ¶æ€ç ä¸º200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var json = pm.response.json();",
                  "",
                  "pm.test('è¿”å›ç™»å½•çŠ¶æ€', function () {",
                  "    pm.expect(json.code).to.eql(200);",
                  "    pm.expect(json.data).to.have.property('status');",
                  "});",
                  "",
                  "// æ ¹æ®çŠ¶æ€è¾“å‡ºæç¤º",
                  "var status = json.data.status;",
                  "if (status === 'WAITING') {",
                  "    console.log('â³ ç­‰å¾…æ‰«ç ...');",
                  "} else if (status === 'SCANNED') {",
                  "    console.log('ğŸ“± å·²æ‰«ç ï¼Œç­‰å¾…ç¡®è®¤...');",
                  "} else if (status === 'CONFIRMED') {",
                  "    console.log('âœ… ç™»å½•æˆåŠŸ! userId=' + json.data.userId);",
                  "} else if (status === 'EXPIRED') {",
                  "    console.log('âŒ äºŒç»´ç å·²è¿‡æœŸï¼Œè¯·é‡æ–°è·å–');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"qrcodeKey\": \"{{qrcodeKey}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/bilibili/qrcode/poll",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bilibili", "qrcode", "poll"]
            },
            "description": "ç­‰å¾…æ‰«ç ç™»å½•å®Œæˆï¼ˆé˜»å¡å¼é•¿è½®è¯¢ï¼‰ã€‚\n\nâš ï¸ æ­¤æ¥å£ä¼šé˜»å¡ç­‰å¾…æœ€é•¿ 300 ç§’ï¼Œç›´åˆ°ç”¨æˆ·æ‰«ç ç¡®è®¤æˆ–äºŒç»´ç è¿‡æœŸã€‚\nè¯·åœ¨ Postman Settings ä¸­å°† Request timeout è®¾ç½®ä¸º 300000msï¼ˆ5åˆ†é’Ÿï¼‰ã€‚\n\nä½¿ç”¨æµç¨‹ï¼š\n1. å…ˆè°ƒç”¨ 1.1 è·å–äºŒç»´ç \n2. ç”¨Bç«™APPæ‰«æäºŒç»´ç \n3. è°ƒç”¨æ­¤æ¥å£ç­‰å¾…ç»“æœ\n\nçŠ¶æ€å€¼ï¼š\n- CONFIRMEDï¼šç™»å½•æˆåŠŸ\n- EXPIREDï¼šäºŒç»´ç è¿‡æœŸæˆ–è¶…æ—¶"
          },
          "response": [
            {
              "name": "ç™»å½•æˆåŠŸ",
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"code\": 200,\n  \"message\": \"success\",\n  \"data\": {\n    \"status\": \"CONFIRMED\",\n    \"message\": \"ç™»å½•æˆåŠŸ\",\n    \"userId\": \"12345678\"\n  }\n}"
            },
            {
              "name": "äºŒç»´ç è¿‡æœŸ",
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"code\": 200,\n  \"message\": \"success\",\n  \"data\": {\n    \"status\": \"EXPIRED\",\n    \"message\": \"äºŒç»´ç å·²è¿‡æœŸï¼Œè¯·é‡æ–°è·å–\"\n  }\n}"
            }
          ]
        },
        {
          "name": "1.3 æ£€æŸ¥ç™»å½•çŠ¶æ€",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('çŠ¶æ€ç ä¸º200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var json = pm.response.json();",
                  "",
                  "pm.test('è¿”å›ç™»å½•çŠ¶æ€', function () {",
                  "    pm.expect(json.code).to.eql(200);",
                  "    pm.expect(json.data).to.have.property('status');",
                  "});",
                  "",
                  "var status = json.data.status;",
                  "if (status === 'CONFIRMED') {",
                  "    console.log('âœ… Cookieæœ‰æ•ˆï¼Œå¯ç›´æ¥å‘å¸ƒ! username=' + json.data.username);",
                  "} else if (status === 'EXPIRED') {",
                  "    console.log('âŒ Cookieå·²è¿‡æœŸï¼Œéœ€è¦é‡æ–°æ‰«ç : ' + json.data.message);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/bilibili/login/status?userId=3494365068528056",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bilibili", "login", "status"],
              "query": [
                {
                  "key": "userId",
                  "value": "3494365068528056",
                  "description": "Bç«™ç”¨æˆ·midï¼Œä»æ‰«ç ç™»å½•è·å–"
                }
              ]
            },
            "description": "æ£€æŸ¥ç”¨æˆ·çš„Bç«™ç™»å½•æ˜¯å¦ä»ç„¶æœ‰æ•ˆã€‚\n\nå‰ç«¯åœ¨ç”¨æˆ·è¿›å…¥å‘å¸ƒé¡µé¢æ—¶è°ƒç”¨æ­¤æ¥å£ï¼š\n- status=CONFIRMEDï¼šCookieæœ‰æ•ˆï¼Œå¯ç›´æ¥å‘å¸ƒè§†é¢‘ï¼Œæ— éœ€é‡æ–°æ‰«ç \n- status=EXPIREDï¼šCookieå·²å¤±æ•ˆæˆ–è¿‡æœŸï¼Œéœ€å¼•å¯¼ç”¨æˆ·é‡æ–°æ‰«ç ç™»å½•\n\næ­¤æ¥å£ä¼šåŒæ—¶éªŒè¯æ•°æ®åº“è®°å½•å’ŒBç«™Cookieçš„å®é™…æœ‰æ•ˆæ€§ã€‚"
          },
          "response": [
            {
              "name": "Cookieæœ‰æ•ˆ",
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"code\": 200,\n  \"message\": \"success\",\n  \"data\": {\n    \"status\": \"CONFIRMED\",\n    \"message\": \"ç™»å½•æœ‰æ•ˆ\",\n    \"userId\": \"3494365068528056\",\n    \"username\": \"ç”¨æˆ·æ˜µç§°\"\n  }\n}"
            },
            {
              "name": "Cookieå·²è¿‡æœŸ",
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"code\": 200,\n  \"message\": \"success\",\n  \"data\": {\n    \"status\": \"EXPIRED\",\n    \"message\": \"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°æ‰«ç \",\n    \"userId\": \"3494365068528056\"\n  }\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "2. ç”¨æˆ·ä¿¡æ¯",
      "description": "è·å–å·²ç™»å½•çš„Bç«™ç”¨æˆ·ä¿¡æ¯",
      "item": [
        {
          "name": "2.1 è·å–ç”¨æˆ·ä¿¡æ¯",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('çŠ¶æ€ç ä¸º200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('è¿”å›ç”¨æˆ·ä¿¡æ¯', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json.code).to.eql(200);",
                  "    console.log('ç”¨æˆ·ä¿¡æ¯: ' + JSON.stringify(json.data));",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/bilibili/user/info?userId=3494365068528056",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bilibili", "user", "info"],
              "query": [{"key": "userId", "value": "3494365068528056", "description": "Bç«™ç”¨æˆ·IDï¼ˆå¯é€‰ï¼‰"}]
            },
            "description": "è·å–å½“å‰ç™»å½•çš„Bç«™ç”¨æˆ·ä¿¡æ¯ï¼ˆå¤´åƒã€æ˜µç§°ã€ç­‰çº§ç­‰ï¼‰ã€‚\n\néœ€è¦å…ˆå®Œæˆæ‰«ç ç™»å½•ã€‚"
          },
          "response": [
            {
              "name": "æˆåŠŸç¤ºä¾‹",
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"code\": 200,\n  \"message\": \"success\",\n  \"data\": {\n    \"mid\": 12345678,\n    \"name\": \"testuser\",\n    \"face\": \"https://i0.hdslb.com/bfs/face/xxx.jpg\",\n    \"level\": 5\n  }\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "3. è§†é¢‘å‘å¸ƒ",
      "description": "è§†é¢‘ä¸Šä¼ ä¸å‘å¸ƒæµç¨‹",
      "item": [
        {
          "name": "3.1 ä¸Šä¼ è§†é¢‘æ–‡ä»¶",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('çŠ¶æ€ç ä¸º200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('è¿”å›æ–‡ä»¶è·¯å¾„', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json.code).to.eql(200);",
                  "    pm.expect(json.data).to.have.property('videoPath');",
                  "    ",
                  "    // è‡ªåŠ¨ä¿å­˜æ–‡ä»¶è·¯å¾„åˆ°å˜é‡",
                  "    pm.collectionVariables.set('uploadedFilePath', json.data.videoPath);",
                  "    console.log('æ–‡ä»¶å·²ä¸Šä¼ : ' + json.data.videoPath);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": "",
                  "description": "é€‰æ‹©è¦ä¸Šä¼ çš„è§†é¢‘æ–‡ä»¶ï¼ˆmp4/flv/aviï¼‰"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/api/bilibili/upload",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bilibili", "upload"]
            },
            "description": "ä¸Šä¼ è§†é¢‘æ–‡ä»¶åˆ°æœåŠ¡å™¨å…±äº«å­˜å‚¨ã€‚\n\næ”¯æŒæ ¼å¼ï¼šmp4, flv, avi ç­‰\næœ€å¤§æ–‡ä»¶å¤§å°ï¼š4096MB\n\nä¸Šä¼ æˆåŠŸå filePath ä¼šè‡ªåŠ¨ä¿å­˜ï¼Œä¾›å‘å¸ƒæ­¥éª¤ä½¿ç”¨ã€‚"
          },
          "response": [
            {
              "name": "ä¸Šä¼ æˆåŠŸ",
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"code\": 200,\n  \"message\": \"success\",\n  \"data\": {\n    \"filePath\": \"/data/videos/1708300000_test.mp4\",\n    \"fileName\": \"test.mp4\",\n    \"fileSize\": 104857600\n  }\n}"
            }
          ]
        },
        {
          "name": "3.2 å‘å¸ƒè§†é¢‘",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('çŠ¶æ€ç ä¸º200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('è¿”å›ä»»åŠ¡ID', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json.code).to.eql(200);",
                  "    ",
                  "    if (json.data && json.data.taskId) {",
                  "        pm.collectionVariables.set('taskId', json.data.taskId);",
                  "        console.log('å‘å¸ƒä»»åŠ¡ID: ' + json.data.taskId);",
                  "    }",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{userId}}\",\n  \"title\": \"æµ‹è¯•è§†é¢‘ - APIè‡ªåŠ¨å‘å¸ƒ\",\n  \"desc\": \"è¿™æ˜¯é€šè¿‡ HUI å‘å¸ƒç³»ç»Ÿä¸Šä¼ çš„æµ‹è¯•è§†é¢‘\",\n  \"tid\": 17,\n  \"tag\": \"æµ‹è¯•,API,è‡ªåŠ¨å‘å¸ƒ\",\n  \"videoPath\": \"{{uploadedFilePath}}\",\n  \"copyright\": 1,\n  \"source\": \"\",\n  \"dynamic\": \"#æµ‹è¯•# é€šè¿‡APIè‡ªåŠ¨å‘å¸ƒ\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/bilibili/publish",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bilibili", "publish"]
            },
            "description": "å°†å·²ä¸Šä¼ çš„è§†é¢‘å‘å¸ƒåˆ°Bç«™ã€‚\n\nå¿…å¡«å­—æ®µï¼š\n- titleï¼šè§†é¢‘æ ‡é¢˜\n- descï¼šè§†é¢‘ç®€ä»‹\n- tidï¼šåˆ†åŒºIDï¼ˆ17=å•æœºæ¸¸æˆ, 21=æ—¥å¸¸, 95=æ•°ç , 122=é‡ç”ŸæŠ€æœ¯åä¼š ç­‰ï¼‰\n- tagï¼šæ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰\n- videoPathï¼šä¸Šä¼ æ­¥éª¤è¿”å›çš„æ–‡ä»¶è·¯å¾„\n\nå¯é€‰å­—æ®µï¼š\n- copyrightï¼š1=è‡ªåˆ¶, 2=è½¬è½½\n- sourceï¼šè½¬è½½æ¥æº\n- dynamicï¼šåŠ¨æ€æ–‡å­—\n- dtimeï¼šå®šæ—¶å‘å¸ƒæ—¶é—´æˆ³ï¼ˆç§’ï¼‰\n- coverPathï¼šå°é¢å›¾è·¯å¾„\n- dolbyï¼šæœæ¯”éŸ³æ•ˆ 0/1\n- openSubtitleï¼šå¼€æ”¾å­—å¹• 0/1"
          },
          "response": [
            {
              "name": "å‘å¸ƒæˆåŠŸ",
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"code\": 200,\n  \"message\": \"success\",\n  \"data\": {\n    \"taskId\": \"task_1708300000\",\n    \"status\": \"PENDING\",\n    \"message\": \"å‘å¸ƒä»»åŠ¡å·²æäº¤\"\n  }\n}"
            }
          ]
        },
        {
          "name": "3.3 æŸ¥è¯¢ä¸Šä¼ çŠ¶æ€",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('çŠ¶æ€ç ä¸º200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('è¿”å›ä»»åŠ¡çŠ¶æ€', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json.code).to.eql(200);",
                  "    console.log('ä»»åŠ¡çŠ¶æ€: ' + JSON.stringify(json.data));",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/bilibili/upload/status/{{taskId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "bilibili", "upload", "status", "{{taskId}}"]
            },
            "description": "æŸ¥è¯¢è§†é¢‘å‘å¸ƒä»»åŠ¡çš„å¤„ç†çŠ¶æ€ã€‚\n\nä½¿ç”¨å‘å¸ƒæ­¥éª¤è¿”å›çš„ taskIdï¼ˆå·²è‡ªåŠ¨å¡«å……ï¼‰ã€‚\n\nçŠ¶æ€å€¼ï¼š\n- PENDINGï¼šç­‰å¾…å¤„ç†\n- UPLOADINGï¼šä¸Šä¼ ä¸­\n- PROCESSINGï¼šå¤„ç†ä¸­\n- SUCCESSï¼šå‘å¸ƒæˆåŠŸ\n- FAILEDï¼šå‘å¸ƒå¤±è´¥"
          },
          "response": [
            {
              "name": "ä¸Šä¼ ä¸­",
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"code\": 200,\n  \"message\": \"success\",\n  \"data\": {\n    \"taskId\": \"task_1708300000\",\n    \"status\": \"UPLOADING\",\n    \"progress\": 45,\n    \"message\": \"ä¸Šä¼ ä¸­ 45%\"\n  }\n}"
            },
            {
              "name": "å‘å¸ƒæˆåŠŸ",
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"code\": 200,\n  \"message\": \"success\",\n  \"data\": {\n    \"taskId\": \"task_1708300000\",\n    \"status\": \"SUCCESS\",\n    \"message\": \"å‘å¸ƒæˆåŠŸ\",\n    \"bvid\": \"BV1xx411c7Xp\"\n  }\n}"
            }
          ]
        }
      ]
    }
  ]
}
